# PART
### Стек: C/C++, eosio.cdt 1.7.0

# Введение
Контракт хранит системное дерево реферальных связей, согласно которым, происходит распределение реферальных вознаграждений в каждом отдельном хосте контракта core. Кроме того, контракт содержит методы установки профиля партнёра, который может использоваться в веб-терминале. 


# Компиляция
Заменить ABSOLUTE_PATH_TO_CONTRACT на абсолютный путь к директории контракта PART. 
```
docker run --rm --name eosio.cdt_v1.7.0 --volume /ABSOLUTE_PATH_TO_CONTRACT:/project -w /project eostudio/eosio.cdt:v1.7.0 /bin/bash -c "eosio-cpp -abigen -I include -R include -contract part -o part.wasm part.cpp" &
```


# Генерация документации
Требуется Doxygen версии от 1.9.3
```
git submodule update --init --recursive
doxygen
```


# Установка
```
cleos set contract part ABSOLUTE_PATH_TO_CONTRACT -p part
```


# Действующие аккаунты
me - собственное имя контракта;
registrator - имя аккаунта регистратора;


# Роли
- Реферал. Партнёр, регистрирующийся в глобальном реферальном дереве. 
- Реферер. Партнёр, пригласивший реферала.  
- Лидер. Партнёр, получающий свободные регистрации рефералов от системы. 

# Сценарии
### Регистрация реферала
Для регистрации партнёра в реферальном дереве, необходимо отправить транзакцию методом reg:
```
cleos push action part '[tester1, tester2, "{}"]' -p tester1'
```
Таким образом, реферал самостоятельно указывает своего реферера при регистрации в дереве. 

Получить таблицу с партнёрами можно так:
```
cleos get table part part partners2
```
В ответе:
```
"rows": [{
      "username": "tester1",
      "referer": "tester2",
      "nickname": "",
      "nickhash": "0000000000000000000000000000000000000000000000000000000000000000",
      "id": 1,
      "cashback": 0,
      "status": "",
      "meta": ""
    },
```


### Изменение реферера
Изменить установленного реферера могут контракты registrator или me. Для этого, они должны отправить транзакцию для реферала с указанием нового реферера:
```
cleos push action part '[tester1, tester3, "{}"]' -p part'
```
Тогда, после получения таблицы, мы увидим результат:
```
"rows": [{
      "username": "tester1",
      "referer": "tester3",
      "nickname": "",
      "nickhash": "0000000000000000000000000000000000000000000000000000000000000000",
      "id": 1,
      "cashback": 0,
      "status": "",
      "meta": ""
    },
```

### Установить профиль партнёра
Для того, чтобы установить профиль партнёра, он должен вызвать метод setprofile за своей подписью. 
```
cleos push action part profupdate '[tester1, "{ican: \"\"}"]' -tester1
``` 
Получим таблицу, увидим результат:
```
"rows": [{
      "username": "tester1",
      "referer": "tester3",
      "nickname": "",
      "nickhash": "0000000000000000000000000000000000000000000000000000000000000000",
      "id": 5,
      "cashback": 0,
      "status": "",
      "meta": "{ican: \"\"}"
    },
```

### Создать лидера
Создать лидера сейчас может только аккаунт контракта me. Для этого, он должен отправить транзакцию со своей подписью: 
```
cleos push action part setstatus '[tester1, headman]' -p part
```
Получим таблицу, увидим результат:
```
"rows": [{
      "username": "tester1",
      "referer": "tester3",
      "nickname": "",
      "nickhash": "0000000000000000000000000000000000000000000000000000000000000000",
      "id": 5,
      "cashback": 0,
      "status": "headman",
      "meta": "{ican: \"\"}"
    },
```


### Получить свободную регистрацию
Для получения свободной регистрации, потенциальный реферал указать пустое имя аккаунта реферера. 
Тогда, регистрация будет произведена под одного из лидеров (в случайном порядке).
```
cleos push action part '[tester4, "", "{}"]' -p tester4
```
Тогда новый партнёр будет зарегистрирован под одного из действующих лидеров:
```
{
  "rows": [{
      "username": "tester4",
      "referer": "tester1",
      "nickname": "",
      "nickhash": "0000000000000000000000000000000000000000000000000000000000000000",
      "id": 27,
      "cashback": 0,
      "status": "",
      "meta": "{}"
    }
```
### Установить никнейм
Каждый пользователь может установить строковый никнейм, используя любые буквы и цифры (что ограничено в имени пользователя). Устанавливая никнейм, пользователь получает уникальный хэш его имени, что может быть использовано в веб-терминале для быстрого поиска по никнеймам. 




### Документация к методам и таблицам контракта
Документация к методам и таблицам контракта доступна в папке docs/html/index.html


# TODO
- Ввести методы установки процента кэшбэка. Контракт предусматривает возможность установки кэшбэка на структуру партнёра, генерирующего реферальное вознаграждение.
- Ввести метод установки никнейма и расчёта хэша.


